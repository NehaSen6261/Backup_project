<ng-template #prevButton>
  <button type="button" class="btn bg-theme text-white shadow point-9 "><i class="fas fa-backward"></i></button>
</ng-template>
<ng-template #nextButton>
  <button type="button" class="btn bg-theme text-white shadow point-9" data-toggle="modal" data-target="#project"
    (click)="popup_title='Add Job';"><i class="fas fa-forward"></i></button>
</ng-template>
<ng-template #doneButton>
  <button type="button" class="btn bg-theme text-white shadow point-9">Completed</button>
</ng-template>
<ng-template #addjob class="point-7">
  Jobs are to be assigned to each Work Order for effective management of the business order completion given by
  customers and keep track of work status !
</ng-template>
<ng-template #Viewjobs class="point-7">
  Jobs are to be assigned to each Work Order for effective management of the business order completion given by
  customers and keep track of work status !
</ng-template>

<sidebar></sidebar>
<navbar></navbar>

<div class="main-window">
  <mat-icon class="mr-5 btn-focus-none cursor" ngbTooltip="Back" placement="right" (click)="backloc();">arrow_back
  </mat-icon>
 <div class="row">
   <div class="col-md-4">
    <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="selected_view == 'tileview'">
      <mat-label>Search</mat-label>
      <input matInput (keyup)="search($event)" [formControl]="filter" placeholder="Search">
    </mat-form-field>
   </div>
   <div class="col-md-4"></div>
   <div class="col-md-4">
    <div class="d-flex justify-content-end mb-3">
      <div class="mr-2 mt-n2" *ngIf="addproject">
        <button type="button"
          class="btn fullscreenbtn bg-theme text-white shadow mt-2 btn-focus-none float-right point-9"
          data-toggle="modal" data-target="#project" (click)="cleardata();clearlength();popup_title='Add Job'"
          id="autoscroll" joyrideStep="addjob" title="Add Job" [stepContent]="addjob" [prevTemplate]="prevButton"
          [nextTemplate]="nextButton" [doneTemplate]="doneButton"><i class="fas fa-plus"></i> Add Job </button>
      </div>
      <mat-button-toggle-group class="mb-1"  [(value)]="selected_view" (change)="toggle_tile($event)">
        <mat-button-toggle class="togglebtn" value="tableview"><i class="fas fa-list mb-3"></i></mat-button-toggle>
        <mat-button-toggle class="togglebtn"  value="tileview"><i class="fas fa-th mb-3"></i></mat-button-toggle>
      </mat-button-toggle-group>
    </div>
   </div>
 </div>

  <div class="card border-radius-point5" style="min-height: 50vh;" *ngIf="selected_view == 'tableview'">
    <div class="card-header bg-transparent border-0">
      <div class="row mb-1">
        <div class="col-md-3">
          <div class="input-group input-group-flush rounded">
            <input type="text" class="form-control point-8 border-radius-point5" (keyup)="search($event)"
              [formControl]="filter" placeholder="Search" aria-describedby="basic-addon1">
          </div>
        </div>
        <div class="col-md-6"></div>
       
      </div>
    </div>

    <div class="table-responsive">
      <mat-progress-bar mode="indeterminate" *ngIf="spinner"></mat-progress-bar>
      <table class="table table-hover" matSort>
        <thead class="point-8 cursor">
          <tr>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="sf_project_code" mat-sort-header>Job Code</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="part_code" mat-sort-header>Part / Item Code</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="asset_name" mat-sort-header>Asset Name</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="sf_project_start_date" mat-sort-header>Duration</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="sf_project_quantity" mat-sort-header>Qlty/Qty</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="total_Rejection_produced" mat-sort-header>Rejection Count</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="sf_project_status" mat-sort-header>Status</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="job_progress" mat-sort-header>Progress</th>
            <th scope="col" class="one1-point text-dark font-light-bold" matColumnDef="action">Action</th>
          </tr>
        </thead>
        <tbody class="point-8">
          <tr *ngFor="let projects of obs | async;index as i">
            <td class="cursor">
              <p  class="max_wid" ngbTooltip={{projects.sf_project_code}}>
                <ngb-highlight [result]="projects.sf_project_code" [term]="filter.value"></ngb-highlight>
                &nbsp; <span *ngIf="projects.is_rework === true" class="text-danger"><i
                    class="fas fa-circle"></i></span>
              </p>
            </td>

            <!-- Part / Item Code  -->
            <td>
              <p *ngIf="projects.part_code == null">
                <ngb-highlight [result]="projects.part_code || 'NA'" [term]="filter.value">
                </ngb-highlight>
              </p>

              <p *ngIf="projects.part_code !=null">
                <ngb-highlight [result]="projects.part_code | slice:0:15" [term]="filter.value">
                </ngb-highlight>
              </p>
            </td>
            <!-- asset_name -->
            <td>
              <p *ngIf="projects.asset_name == null">
                <ngb-highlight [result]="projects.asset_name || 'NA'" [term]="filter.value">
                </ngb-highlight>
              </p>

              <p *ngIf="projects.asset_name !=null">
                <ngb-highlight [result]="projects.asset_name | slice:0:15" [term]="filter.value">
                </ngb-highlight>
              </p>
            </td>
            <!-- Duration  -->
            <td >
              <p class="max_wid">
              <ngb-highlight [result]="projects.sf_project_start_date +'/'+ projects.sf_project_end_date "
                [term]="filter.value"></ngb-highlight>
              </p>
            </td>
            <td class="cursor">
              <ng-template #list>
                <div class="d-flex flex-column">
                  <span>Quality Produced: {{projects.total_qlty_produced}}</span>
                  <span>Order Quantity: {{projects.sf_project_quantity}}</span>
                </div>
              </ng-template>
              <ngb-highlight [result]="projects.total_qlty_produced +'/'+ projects.sf_project_quantity "
                [ngbTooltip]='list' [term]="filter.value"></ngb-highlight>
            </td>
            <td>
              <ngb-highlight [result]="projects.total_scrap_produced " [term]="filter.value"></ngb-highlight>
            </td>

            <td>

              <p class="max_wid" *ngIf="projects.sf_project_status == 'inprogress'"><span
                  class="badge badge-pill badge-primary">In progress</span> </p>
              <p class="max_wid" *ngIf="projects.sf_project_status == 'notstarted' "> <span
                  class="badge badge-pill badge-warning">Yet to start</span></p>
              <p class="max_wid" *ngIf="projects.sf_project_status == 'completed' "><span
                  class="badge badge-pill badge-success">Completed</span> </p>
              <p class="max_wid" *ngIf="projects.sf_project_status == 'halt' "><span
                  class="badge badge-pill badge-danger">Halt</span> </p>
              <p class="max_wid" *ngIf="projects.sf_project_status == 'expired' "><span
                  class="badge badge-pill badge-danger">Expired</span> </p>

            </td>
            <!-- job progress -->
            <td>
              <p class="mt-2" ngbTooltip=' {{projects.job_progress}}%'>
                <mat-progress-bar mode="determinate" value={{projects.job_progress}}></mat-progress-bar>
              </p>
            </td>
            <td class="d-flex">
              <!-- edit button icon -->
              <span class="cursor" ngbTooltip="Edit" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Edit Job'"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')&& projects.sf_project_status != 'completed' && projects.sf_project_status != 'inprogress' && projects.sf_project_status != 'halt'">
                <i class="far fa-edit text-theme"></i></span>
              <span class="cursor" ngbTooltip="Edit" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Edit Job';"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')&& (projects.sf_project_status == 'inprogress' || projects.sf_project_status == 'halt')">
                <i class="far fa-edit text-theme"></i></span>

              <!-- View button icon -->
              <span class="cursor" ngbTooltip="View" data-toggle="modal" data-target="#project" joyrideStep="Viewjobs"
                title="View Job" [stepContent]="Viewjobs" [prevTemplate]="prevButton" [nextTemplate]="nextButton"
                [doneTemplate]="doneButton" (click)="projectInfo(projects);popup_title='View Job'" *ngIf="(authService.currentUser['role_id'] == 2 || authService.currentUser['role_id'] == 'MV1001' ||authService.currentUser['role_id'] == 'PV1001' || this.authService.currentUser['role_id'] == 'WCV1001'|| this.authService.currentUser['role_id'] == 'ASV1001' || this.authService.currentUser['role_id'] == 'JB1001')
                 || projects.sf_project_status == 'completed'"><i class="fas fa-eye fa-lg text-theme"></i></span>
              <!-- Clone button icon -->
              <span class="cursor ml-2" ngbTooltip="Clone" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Clone a Job';  Clear_cloned_fields();"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')">
                <i class="far fa-clone"></i></span>
              <!-- Assign Jobs to job worker -->
              <span class="cursor ml-2" (click)="projectInfo(projects); getJobworkers(projects.sf_asset_id)" data-toggle="modal"
                data-target="#jobworker_model"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001') &&(projects.sf_project_status == 'inprogress' || projects.sf_project_status == 'halt' || projects.sf_project_status=='notstarted'||projects.sf_project_status!='completed')">
               <div class="d-flex flex-row"> <i class="fas fa-user-edit mt-1" [class.alerticon]="projects.operator_name == 'No Assignee'" [class.assigned_op]="projects.operator_name != 'No Assignee'" ngbTooltip="Assign Jobs"></i>
              </div>
              </span>

              <span class="cursor ml-2" ngbTooltip="Assign Jobs"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001') &&projects.sf_project_status == 'completed'">
                <i class="fas fa-user-edit disableicon"></i></span>
            </td>

          </tr>

        </tbody>

      </table>
      <div class="d-flex justify-content-center mt-2 " *ngIf="spinner">
        <ngx-skeleton-loader class="w-100" count="5" animation="pulse"
          [theme]="{'border-radius': '5px', height: '50px', 'animation-duration': '2s' }">
        </ngx-skeleton-loader>
      </div>

      <div class="text-center mt-5" *ngIf="displaydata">
        <p><i class="fas fa-table mr-1 fa-3x opacity-point-3"></i></p>
        <small class="point-8 "> No jobs available to display !!</small>
      </div>

      <div class="d-flex justify-content-center flex-wrap mt-5" *ngIf="internalError">
        <small class="point-8 "> <i class="fas fa-exclamation-triangle text-warning mr-1"></i> Unable to process your
          request please try after some time !!</small>
      </div>
      <mat-paginator class="mat-paginator-sticky" [length]="100" [pageSize]="5" [pageSizeOptions]="[5, 10, 20, 50, 100]"
*ngIf="projects.length !=0 && selected_view == 'tableview'"></mat-paginator>

     

    </div>
  </div>
  <div *ngIf="selected_view == 'tileview'">
    <div class="d-flex justify-content-center flex-wrap mt-5" *ngIf="internalError">
      <small class="point-8 "> <i class="fas fa-exclamation-triangle text-warning mr-1"></i> Unable to process your request please try after some time !!</small>
    </div>
    <div class="text-center mt-5" *ngIf="displaydata">
      <p><i class="fas fa-grip-horizontal mr-1 fa-3x opacity-point-3"></i></p>
      <small class="point-8 ">No jobs available to display !!</small>
    </div>
    <div class="d-flex justify-content-center mt-5 "  *ngIf="spinner">
      <ngx-skeleton-loader  count="4" appearance="circle" animation="progress"
            [theme]="{  width: '150px', height: '150px',   'border-radius': '10px' }">
    </ngx-skeleton-loader>
    </div>
    <!-- Tile View -->
    <div class="row">
      <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 d-flex mb-3" *ngFor="let projects of obs | async;index as i">
        <div class="card flex-fill border-radius_main_card">
          <div  class="card-header bg-transparent" style="height: 50px;"> 
             
                <p class="point-8 float-left jobwrkname_dis" ngbTooltip={{projects.sf_project_code}}>
                  <ngb-highlight [result]="projects.sf_project_code" [term]="filter.value"></ngb-highlight>
                  &nbsp; <span *ngIf="projects.is_rework === true" class="text-danger"><i
                      class="fas fa-circle"></i></span>
                </p>
            <p class="float-right d-flex justify-content-end mr-n3">
              <!-- edit button icon -->
              <span class="cursor" ngbTooltip="Edit" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Edit Job'"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')&& projects.sf_project_status != 'completed' && projects.sf_project_status != 'inprogress' && projects.sf_project_status != 'halt'">
                <i class="far fa-edit iconsbg"></i></span>
              <span class="cursor" ngbTooltip="Edit" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Edit Job';"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')&& (projects.sf_project_status == 'inprogress' || projects.sf_project_status == 'halt')">
                <i class="far fa-edit iconsbg"></i></span>

              <!-- View button icon -->
              <span class="cursor" ngbTooltip="View" data-toggle="modal" data-target="#project" joyrideStep="Viewjobs"
                title="View Job" [stepContent]="Viewjobs" [prevTemplate]="prevButton" [nextTemplate]="nextButton"
                [doneTemplate]="doneButton" (click)="projectInfo(projects);popup_title='View Job'" *ngIf="(authService.currentUser['role_id'] == 2 || authService.currentUser['role_id'] == 'MV1001' ||authService.currentUser['role_id'] == 'PV1001' || this.authService.currentUser['role_id'] == 'WCV1001'|| this.authService.currentUser['role_id'] == 'ASV1001' || this.authService.currentUser['role_id'] == 'JB1001')
                 || projects.sf_project_status == 'completed'"><i class="fas fa-eye fa-lg iconsbg eye_align"></i></span>
              <!-- Clone button icon -->
              <span class="cursor ml-2" ngbTooltip="Clone" data-toggle="modal" data-target="#project"
                (click)="projectInfo(projects);popup_title='Clone a Job';  Clear_cloned_fields();"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001')">
                <i class="far fa-clone iconsbg"></i></span>
              <!-- Assign Jobs to job worker -->
              <span class="cursor ml-2" (click)="projectInfo(projects);getJobworkers(projects.sf_asset_id)" data-toggle="modal"
                data-target="#jobworker_model"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001') &&(projects.sf_project_status == 'inprogress' || projects.sf_project_status == 'halt' || projects.sf_project_status=='notstarted'||projects.sf_project_status!='completed')">
               <div class="d-flex flex-row"> <i class="far fa-user-circle iconsbg" ngbTooltip="Assign Jobs"></i>
                <mat-icon  [class.cardalerticon]="projects.operator_name =='No Assignee' " [class.card_assigned_op]="projects.operator_name !='No Assignee'">fiber_manual_record</mat-icon>
              </div>
              </span>
              <span class="cursor ml-2" ngbTooltip="Assign Jobs"
                *ngIf="(authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001') &&projects.sf_project_status == 'completed'">
                <i class="far fa-user-circle iconsbg disableicon"></i></span>
            </p>
           
        </div>
        <p class="" ngbTooltip=' {{projects.job_progress}}%'>
          <mat-progress-bar mode="determinate" value={{projects.job_progress}}></mat-progress-bar>
        </p>
        <div class="card-body point-9"
         [class.status_indication_inprg]="projects.sf_project_status == 'inprogress'"
         [class.status_indication_yetstart]="projects.sf_project_status == 'notstarted'"
         [class.status_indication_comp]="projects.sf_project_status == 'completed'"
         [class.status_indication_halt]="projects.sf_project_status == 'halt'"
         [class.status_indication_expired]="projects.sf_project_status == 'expired'"
         >
        <div class="row  mt-n4">
          <div class="col-4 mb-n4">
            <p class="font-weight-bold point-9"  *ngIf="authService.currentUser['role_id'] != 'JB1001'">Job Operator :</p>
            <p class="text_align_des font-weight-bold">Job Type :</p>
           <p  class="text_align_des max_wid font-weight-bold">Part / Item Code   :</p>
           <p class="text_align_des font-weight-bold">Asset Name  :</p>
           <p class="text_align_des font-weight-bold">Duration    :</p>
           <p class="text_align_des font-weight-bold">Qlty/Qty    :</p>
           <p class="text_align_des max_wid font-weight-bold">Rejection Count :</p>
           <p class="text_align_des font-weight-bold">Status :</p>
          </div>
          <div class="col-8 mb-n4">
            <!-- Job Operator -->
            <p class="point-9" ngbTooltip={{projects.operator_name}}  
            *ngIf="(authService.currentUser['role_id'] != 'JB1001') &&
             projects.operator_name=='No Assignee' 
            ">
           
              <ngb-highlight [result]="projects.operator_name || 'No Assignee'" [term]="filter.value"></ngb-highlight>
            </p> 
            
           <p class="point-9" *ngIf = "(authService.currentUser['role_id'] != 'JB1001') && projects.operator_name!='No Assignee' && projects.operator_name.length == 2" ngbTooltip = {{projects.operator_name}}>
            <ngb-highlight [result]="projects.operator_name[0]| slice:0:15 " [term]="filter.value"></ngb-highlight>
            <a   class="cursor" data-target="#job_operators_name" data-toggle="modal" (click)="jobOperatorName(projects.operator_name)">...more</a>
            
          </p>

          <p class="point-9" *ngIf = "(authService.currentUser['role_id'] != 'JB1001') && projects.operator_name!='No Assignee' && projects.operator_name.length ==1" ngbTooltip = {{projects.operator_name}}>
            <ngb-highlight [result]="projects.operator_name[0]| slice:0:15 " [term]="filter.value"></ngb-highlight> 
          </p>

            <p class="point-9" *ngIf = "(authService.currentUser['role_id'] != 'JB1001') && projects.operator_name!='No Assignee'&& projects.operator_name.length>2" ngbTooltip = {{projects.operator_name}}>
              <ngb-highlight [result]="projects.operator_name.slice(0,2) " [term]="filter.value"></ngb-highlight>
              <a   class="cursor" data-target="#job_operators_name" data-toggle="modal" (click)="jobOperatorName(projects.operator_name)">...more</a>
            </p>
              <!-- Job Type -->
              <p class="text_align_des" *ngIf="projects.project_type == null">
                <ngb-highlight [result]="projects.project_type || 'NA' " [term]="filter.value"></ngb-highlight>
              </p>
              <p class="text_align_des" *ngIf="projects.project_type != null" ngbTooltip={{projects.project_type}}>
                <ngb-highlight [result]="projects.project_type " [term]="filter.value"></ngb-highlight>
              </p>  
            <!-- Part / Item Code -->
            <p  class="text_align_des" *ngIf="projects.part_code == null">
              <ngb-highlight [result]="projects.part_code || 'NA'" [term]="filter.value">
              </ngb-highlight>
            </p>

            <p  class="text_align_des" *ngIf="projects.part_code !=null">
              <ngb-highlight [result]="projects.part_code | slice:0:15" [term]="filter.value">
              </ngb-highlight>
            </p>

            <!-- Asset Name -->
            <p  class="text_align_des" *ngIf="projects.asset_name == null">
              <ngb-highlight [result]="projects.asset_name || 'NA'" [term]="filter.value">
              </ngb-highlight>
            </p>

            <p  class="text_align_des" *ngIf="projects.asset_name !=null">
              <ngb-highlight [result]="projects.asset_name | slice:0:15" [term]="filter.value">
              </ngb-highlight>
            </p>
            <!-- Duration -->
            <p class="text_align_des">
            <ngb-highlight   [result]="projects.sf_project_start_date +'/'+ projects.sf_project_end_date "
            [term]="filter.value"></ngb-highlight>
            </p>
            <!-- Qlty/Qty -->
            <p class="text_align_des">
            <ng-template #list>
              <div class="d-flex flex-column">
                <span>Total Quality:{{projects.total_qlty_produced }}</span>
                <span> Total Quantity:{{projects.sf_project_quantity}}</span>
              </div>
            </ng-template>
  
            <ngb-highlight  [result]="projects.total_qlty_produced +'/'+ projects.sf_project_quantity "
              [ngbTooltip]='list' [term]="filter.value"></ngb-highlight>
            </p>
              <!-- Rejection Count -->
              <p class="text_align_des">
              <ngb-highlight   [result]="projects.total_scrap_produced " [term]="filter.value"></ngb-highlight>
            </p>
            <!-- Status -->
            <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'inprogress'"><span
              class="badge badge-pill badge-primary">In progress</span> </p>
          <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'In Progress' "><span
              class="badge badge-pill badge-primary">In progress</span> </p>
          <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'notstarted' "> <span
              class="badge badge-pill badge-warning">Yet to start</span></p>
          <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'completed' "><span
              class="badge badge-pill badge-success">Completed</span> </p>
          <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'halt' "><span
              class="badge badge-pill badge-danger">Halt</span> </p>
          <p class="max_wid point-8" *ngIf="projects.sf_project_status == 'expired' "><span
              class="badge badge-pill badge-danger">Expired</span> </p>   
          </div>
        </div>
        </div>
      </div>
    </div>
  </div>
  
 
</div>
<mat-paginator class="mat-paginator-sticky" [length]="100" [pageSize]="5" [pageSizeOptions]="[5, 10, 20, 50, 100]"
*ngIf="projects.length !=0 && selected_view == 'tileview'"></mat-paginator>
<p class="font-italic point-8 mt-2"><i class="fas fa-circle text-danger"></i> Indicates rework!</p>





<!-- side panel  for Add and Edit Plant-->
<div class="modal left fade" id="project" tabindex="" role="dialog" aria-labelledby="projectLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal_general_popup" role="document">
    <button type="button" class="btn text-white modal-close-btn cursor bg-sidebar" data-dismiss="modal"><span
        class="cursor" aria-hidden="true" (click)="clearlength();onLoad();">&times;</span></button>
    <div class="modal-content">
      <div class="modal-header bg-white">
        <h5 class="modal-title "
          *ngIf="authService.currentUser['role_id'] == 1 || authService.currentUser['role_id'] == 'PA1001' || this.authService.currentUser['role_id'] == 'WCA1001' || this.authService.currentUser['role_id'] == 'ASA1001'">
          {{popup_title}}</h5>
        <h5 class="modal-title"
          *ngIf="authService.currentUser['role_id'] == 2 || authService.currentUser['role_id'] == 'MV1001'
           ||authService.currentUser['role_id'] == 'PV1001' || this.authService.currentUser['role_id'] == 'WCV1001'
           || this.authService.currentUser['role_id'] == 'ASV1001' || this.authService.currentUser['role_id'] == 'JB1001'">
          View Job</h5>
      </div>
      <div class="modal-body" style="overflow-y: auto;">

        <!-- Plants dropdown -->
        <mat-form-field appearance="outline" class="w-100 point-8">
          <mat-label *ngIf="plants.length != 0">Choose a Plant</mat-label>
          <mat-label *ngIf="plants.length == 0">No Plant available</mat-label>
          <mat-select [formControl]="plant" required>
            <mat-option *ngFor="let plant of plants" [value]="plant.sf_plant_id"
              (click)="getplantWorkcenters(plant.sf_plant_id)">
              {{plant.sf_plant_name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="plant.invalid && plants.length != 0">{{PlantErrorMessages()}}</mat-error>
          <mat-error *ngIf="plants.length == 0">No Plant available please create one !!</mat-error>
        </mat-form-field>

        <!-- workcenter -->
        <mat-form-field appearance="outline" class="w-100 point-8">
          <mat-label *ngIf="plant_workcenters.length != 0">Choose a work center</mat-label>
          <mat-label *ngIf="plant_workcenters.length == 0">No work center available</mat-label>
          <mat-select [formControl]="work_center" (selectionChange)="ifchange($event)" required>
            <mat-option *ngFor="let workcenter of plant_workcenters" [value]="workcenter.sf_work_centre_id"
              (click)="getWCAssets(workcenter.sf_work_centre_id)">
              {{workcenter.sf_work_centre_name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="work_center.invalid && plant_workcenters.length != 0">{{WorkcentersErrorMessages()}}
          </mat-error>
          <mat-error *ngIf="plant_workcenters.length == 0">No work center available please create workcenter !!
          </mat-error>
        </mat-form-field>

          <!-- assets -->
          <mat-form-field appearance="outline" class="w-100 point-8">
            <mat-label *ngIf="workcenter_asset.length != 0">Choose an asset</mat-label>
            <mat-label *ngIf="workcenter_asset.length == 0">No asset available</mat-label>
            <mat-select [formControl]="asstes" required>
              <mat-option *ngFor="let asset of workcenter_asset" [value]="asset.sf_asset_id">
                {{asset.sf_asset_name}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="asstes.invalid && workcenter_asset.length != 0">{{AsstesErrorMessages()}}</mat-error>
            <mat-error *ngIf="workcenter_asset.length == 0">No asset available please create one !!</mat-error>
          </mat-form-field>

          <!-- Job Type -->
          <mat-form-field appearance="outline" class="w-100 point-8">
            <mat-label>Job Type</mat-label>
            <mat-select [formControl]="jb_type" required>
              <mat-option  *ngFor="let job_type of job_type_list" [value]="job_type.value">
                {{job_type.viewValue}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="jb_type.invalid">{{jb_typeErrorMessages()}}</mat-error>
          </mat-form-field>

        <!-- Job code -->
        <mat-form-field appearance="outline" class="w-100 point-8">
          <mat-label>Job code</mat-label>
          <input matInput maxlength="40" [formControl]="project_code" id="auto_trigger"
            (input)="validateJobCode($event.target.value)" required>
          <mat-error *ngIf="project_code.invalid">{{ProjectCodeErrorMessages()}}</mat-error>
        </mat-form-field>

        <!-- workorder dropdown -->
        
         <!-- here we validate the based on status -->
       
        <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="work_order_list">
          <mat-label *ngIf="workordernameList.length != 0">Choose a workorder</mat-label>
          <mat-label *ngIf="workordernameList.length == 0">No workorders available</mat-label>
          <mat-select [formControl]="wrkOrderName"  panelClass="max-height" required>
            <mat-option *ngFor="let wrkordername of workordernameList" [value]="wrkordername.sf_workorder_id"
              (click)="this.work_order_select_qty=wrkordername.work_order_qty">
              {{wrkordername.work_order_name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="wrkOrderName.invalid">{{WorkOrderErrorMessages()}}</mat-error>
        </mat-form-field>

  
 
          <!-- workorder dropdown -->
          <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="work_order_project">
            <mat-label *ngIf="projects.length != 0">Choose a workorder</mat-label>
          <mat-label *ngIf="projects.length == 0">No workorders available</mat-label>
          <mat-select [formControl]="wrkOrderName"  panelClass="max-height" required>
            <mat-option *ngFor="let wrorderproject of projects" [value]="wrorderproject.sf_workorder_id">
              {{wrorderproject.work_order_name}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="wrkOrderName.invalid">{{WorkOrderErrorMessages()}}</mat-error>
        </mat-form-field>

 

        <!--Part Code-->
        <mat-form-field appearance="outline" class="w-100 point-8">
          <mat-label *ngIf="partcode.length !=0">Part / Item Code</mat-label>
          <mat-label *ngIf="partcode.length ==0">No Part / Item Code available </mat-label>
          <mat-select [formControl]="part_code" minlength="3" maxlength="40" required>
            <mat-option *ngFor="let partcodes of partcode" [value]="partcodes.sf_part_id"
              (click)="this.part_child_parents=partcodes.sf_part_is_child">
              <span>{{partcodes.sf_part_code}}
                <span class="point-8" *ngIf="partcodes.sf_part_is_child == false"> (Parent part / Item)</span>
                <span class="point-8" *ngIf="partcodes.sf_part_is_child == true">(child part / Item)</span>
              </span>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="part_code.touched ||  part_code.invalid">{{partCodeError()}}</mat-error>
        </mat-form-field>

        <!-- Job Order Quantity -->
        <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="part_child_parents==false">
          <mat-label>Job Order Quantity <span class="point-7">(units)</span></mat-label>
          <input matInput maxlength="40" [formControl]="project_quantity" type="number" min="0"oninput="this.value = Math.abs(this.value)" (input)="quantityCheck($event)" required>
          <mat-error *ngIf="project_quantity.invalid">{{ProjectQtyErrorMessages()}}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="part_child_parents!=false">
        <mat-label>Job Order Quantity <span class="point-7">(units)</span></mat-label>
        <input matInput maxlength="40" [formControl]="project_quantity" type="number" min="0" oninput="this.value = Math.abs(this.value)" required>
        <mat-error *ngIf="project_quantity.invalid">{{ProjectQtyErrorMessages()}}</mat-error>
        </mat-form-field>


        <!-- start date -->
        <mat-form-field appearance="outline" class="w-100 point-8" (click)="start_picker.open()">
          <mat-label>Start date</mat-label>
          <input matInput [matDatepicker]="start_picker" [formControl]="start_date" [min]="todayDate"  [max]="end_date.value" required>
          <mat-datepicker-toggle matSuffix [for]="start_picker"></mat-datepicker-toggle>
          <mat-datepicker #start_picker></mat-datepicker>
          <mat-error *ngIf="start_date.touched ||  start_date.invalid">Please enter a valid start date</mat-error>
        </mat-form-field>

        <!-- end date -->
        <mat-form-field appearance="outline" class="w-100 point-8" (click)="end_picker.open();">
          <mat-label>End date</mat-label>
          <input matInput [matDatepicker]="end_picker" [formControl]="end_date" [min]="start_date.value"
            [max]="this.end_date_show" required>
          <mat-datepicker-toggle matSuffix [for]="end_picker"></mat-datepicker-toggle>
          <mat-datepicker #end_picker></mat-datepicker>
          <mat-error *ngIf="end_date.touched ||  end_date.invalid">Please enter a valid end date</mat-error>
        </mat-form-field>


        <!-- project status -->
        <!-- here we validate the rework enabling and disabling based on the job progress and status -->
        <div *ngIf="this.status_progress == 'expired'">
          <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="status_dropdwon">
            <mat-label>Status</mat-label>
            <mat-select [formControl]="project_status" (selectionChange)="disable_rework($event)">
              <mat-option [disabled]="status.value == 'expired'  || status.value == 'notstarted'"
                *ngFor="let status of project_status_list" [value]="status.value">
                {{status.viewValue}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="(this.status_progress == 'notstarted' ||this.status_progress == 'completed'||this.status_progress == 'inprogress' || this.status_progress == 'halt') && (jb_progress == 0 && total_quantity == 0)">
          <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="status_dropdwon">
            <mat-label>Status</mat-label>
            <mat-select [formControl]="project_status" (selectionChange)="disable_rework($event)">
              <mat-option [disabled]="status.value == 'expired'" *ngFor="let status of project_status_list"
                [value]="status.value">
                {{status.viewValue}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div *ngIf="(this.status_progress == 'inprogress' || this.status_progress == 'halt' ||this.status_progress == 'completed') &&(( jb_progress > 0 && total_quantity > 0)||( jb_progress > 0 && total_quantity == 0)|| ( jb_progress == 0 && total_quantity > 0)) ">
          <mat-form-field appearance="outline" class="w-100 point-8" *ngIf="status_dropdwon">
            <mat-label>Status</mat-label>
            <mat-select [formControl]="project_status" (selectionChange)="change($event)">
              <mat-option [disabled]="status.value == 'expired'|| status.value == 'notstarted'"
                *ngFor="let status of project_status_list" [value]="status.value">
                {{status.viewValue}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- Rework  -->
        <mat-checkbox class="point-8" [formControl]="rework" checked color="primary">Rework</mat-checkbox>
      </div>


      <div class="modal-footer footer_btn w-100" *ngIf="popup_title== 'Add Job' " [hidden]="!addproject">
        <button type="button" class="btn btn-sm float-right shadow text-white bg-theme btn-clear point-9 mr-1"
          (click)="cleardata();"><i class="fas fa-undo"></i> Clear</button>
        <button type="submit" *ngIf="!disabled_enable_button"
          class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1"
          (click)="saveproject(); this.joyride.closeTour(); onLoad()"><i class="far fa-check-circle"></i>
          Submit</button>
        <button class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1" type="button" disabled
          *ngIf="disabled_enable_button">
          <i class="fas fa-spinner fa-pulse"></i> Loading
        </button>
      </div>
      <!-- Edit job update and delete buttons -->
      <div class="modal-footer footer_btn  w-100" *ngIf="popup_title== 'Edit Job' " [hidden]="!addproject">
        <button type="button" class="btn btn-sm float-right shadow text-white bg-theme btn-delete point-9 mr-1"
          data-toggle="modal" data-target="#exampleModalCenter" data-dismiss="modal"> <i class="fas fa-trash-alt"></i>
          Delete</button>
        <button type="submit" class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1"
          (click)="completed_status();"><i class="far fa-check-circle"></i> Update</button>
      </div>
      <!-- Clone a Job submit  and delete buttons -->
      <div class="modal-footer footer_btn  w-100" *ngIf="popup_title == 'Clone a Job' " [hidden]="!addproject">
        <button type="submit" *ngIf="!disabled_enable_button" class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1"
          (click)="saveproject();"><i class="far fa-check-circle"></i> Submit</button>
          <button class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1" type="button" disabled
          *ngIf="disabled_enable_button">
          <i class="fas fa-spinner fa-pulse"></i> Loading
        </button>
      </div>
      <!-- View job close buttons -->
      <div class="modal-footer footer_btn w-100" *ngIf="popup_title == 'View Job'">
        <button type="submit" class="btn btn-sm float-right shadow text-white bg-theme btn-save point-9 mr-1"
          data-dismiss="modal"><i class="fas fa-times"></i> Close</button>
      </div>

    </div>
  </div>
</div>

<!-- Delete projects Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog border-radius-point5" role="document">
    <div class="modal-content ">
      <div class="modal-header bg-white border_top">
        <h6 class="modal-title" id="exampleModalLongTitle">Delete</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body point-9">
        Are you sure to delete <span class="text-danger">{{project_code.value}}</span> ?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-delete-yes point-8" data-dismiss="modal"
          (click)="deleteProject();"><i class="fas fa-check"></i> Yes</button>
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-delete-no point-8" data-dismiss="modal"
          data-toggle="modal" data-target="#project"><i class="fas fa-times"></i> No</button>
      </div>
    </div>
  </div>
</div>

<!--Tour Guide End  Modal -->
<div class="modal  fade" id="tourguideEnd" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px;">
      <div class="modal-header border-0 image_header">
        <img [src]="img_tour_ends" class="img-fluid" style="margin: auto;">
      </div>
      <div class="modal-body">
        <div class="p-2 text-center mt-3">
          <h3 class="font-weight-bold ">You're all set!</h3>
          <p class="point-9">Now your ready to configure your application. </p>
          <button class="btn bg-theme text-white point-9" data-dismiss="modal">Lets Start!</button>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Job is moved to completed alert popup -->
<div class="modal fade" id="completed_alert" tabindex="-1" aria-labelledby="completed_alertLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-transparent border_top">
        <h6 class="modal-title" id="completed_alertLabel">
          Are you sure to move the jobs to completed?
        </h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body ">
        <p class="point-8">Order Quantity :<span class="text-danger"> {{project_quantity_count }}</span>
          &nbsp;<span> Total Quantity Produced : <span class="text-danger">{{total_qty_produced_count}}</span></span>
        </p>
        <p class="point-7 float-left font-italic mb-n5">** Quantity produced is less than the order quantity.</p>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-delete-yes point-8" data-dismiss="modal"
          (click)="updateProject();"><i class="fas fa-check"></i> Yes</button>
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-delete-no point-8" data-dismiss="modal"
          data-toggle="modal" data-target="#completed_alert"><i class="fas fa-times"></i> No</button>
      </div>
    </div>
  </div>
</div>

<!-- Assignee job -->
<div class="modal fade" id="jobworker_model" tabindex="-1" aria-labelledby="jobworker_modelLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-transparent border_top">
        <h6 class="modal-title" id="jobworker_modelLabel">
          Assign Job
        </h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body ">
        <mat-form-field appearance="outline" class="w-100 point-8">
          <mat-label *ngIf="job_workers.length != 0">Choose Job Operator</mat-label>
          <mat-label *ngIf="job_workers.length == 0">No Job Operator's available</mat-label>
          <mat-select [formControl]="jb_worker" #select multiple required> 
           <mat-option *ngFor="let jb_workers of job_workers" [disabled]="ischack" [value]="jb_workers.factory_user_id">
           {{jb_workers.user_first_name + ' ' + jb_workers.user_last_name}}
            </mat-option> 
            </mat-select>
          <mat-error *ngIf="jb_worker.touched ||  jb_worker.invalid">{{jb_workerError()}}</mat-error>
        </mat-form-field>
       
    
        <mat-checkbox color="primary"  class="ml-1 point-8" [formControl]="noassignee"  (change)="showCheckRest($event)">No Assignee</mat-checkbox >
                        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-save point-8" data-dismiss="modal"
          (click)="updateOperator();"><i class="fas fa-check"></i> Update</button>
        <button type="button" class="btn btn-sm shadow text-white bg-theme btn-save point-8 " data-dismiss="modal"><i
            class="fas fa-times"></i> Cancel</button>
      </div>
    </div>
  </div>
</div>


<!-- job operators name list -->

<div class="modal fade" id="job_operators_name" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog"
aria-labelledby="job_operators_name_label" aria-hidden="true" cdkDrag>
<div class="modal-dialog  modal-dialog-scrollable"  style="width: 400px;">
<div class="modal-content">
 <div class="modal-header bg-transparent border_top">
  <h6 class="modal-title" id="job_operators_name_label">
    Job Operators Names
  </h6>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="modal-body  mt-1 "style=" height: 180px;overflow-x: auto;" >
  <table class="table table-bordered ">
    <tbody >
      <tr *ngFor="let element of operatorName;" >
        <td  class="point-8" style="line-height: 10px;">
            {{element}}
         </td>
    </tr>
  </tbody>
</table>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-sm shadow text-white bg-theme btn-save point-8 " data-dismiss="modal"><i
    class="fas fa-times"></i> Cancel</button>
</div>
</div>
</div>
</div>
